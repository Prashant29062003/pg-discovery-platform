generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum RoomType {
  SINGLE
  DOUBLE
  TRIPLE
  OTHER
}

enum EnquiryStatus {
  NEW
  CONTACTED
  CLOSED
}

model PG {
  id          String   @id @default(cuid())
  slug        String   @unique
  name        String
  description String   @db.Text
  images      String[]
  amenities   String[]
  isFeatured  Boolean  @default(false)
  address     String
  city        String   // Added for filtering per PRD 4.3
  locality    String   // Added for SEO per PRD 4.3
  
  rooms       Room[]
  enquiries   Enquiry[]
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([slug])
  @@index([isFeatured])
  @@index([city])
}

model Room {
  id         String   @id @default(cuid())
  pgId       String
  pg         PG       @relation(fields: [pgId], references: [id], onDelete: Cascade)
  roomNumber String
  type       RoomType @default(SINGLE)
  basePrice  Float
  
  beds       Bed[]

  @@unique([pgId, roomNumber])
}

model Bed {
  id         String   @id @default(cuid())
  roomId     String
  room       Room     @relation(fields: [roomId], references: [id], onDelete: Cascade)
  isOccupied Boolean  @default(false)
}

model Enquiry {
  id        String        @id @default(cuid())
  pgId      String
  pg        PG            @relation(fields: [pgId], references: [id])
  name      String
  phone     String
  message   String?       @db.Text
  status    EnquiryStatus @default(NEW)
  
  createdAt DateTime      @default(now())

  // Helps with the "One enquiry per phone per PG" rule logic
  @@index([phone, pgId, createdAt])
}